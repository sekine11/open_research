<div class="max-vw-100 bg-dark shadow text-light">
	<h2 class="h3 p-3"><%= @laboratory.name %></h2>
</div>
<div class="container">
	<div class="row my-4">
		<div class="col-5 mb-4">
			<div id="calendar"></div>
			<div class="text-right w-100 mt-2">
				<button type="button" class="btn btn-success btn-sm" data-toggle="modal" data-target="#new-event">
				  予定を登録
				</button>
			</div>
		</div>
		<div class="col-7 mb-4">
			<table class="table table-sm">
				<thead class="thead-dark">
					<tr>
						<th colspan="4">ラボタスク</th>
					</tr>
				</thead>
				<tbody class="border-bottom">
					<% @lab_tasks.each do |task| %>
						<tr>
							<td>
								<% if task.status_i18n == "未完了" %>
									<div class="alert-danger btn btn-sm">
										<%= task.status_i18n %>
									</div>
								<% elsif task.status_i18n == "進行中" %>
									<div class="alert-warning btn btn-sm">
										<%= task.status_i18n %>
									</div>
								<% else %>
									<div class="alert-success btn btn-sm">
										<%= task.status_i18n %>
									</div>
								<% end %>
							</td>
							<td class="align-middle font-weight-bold"><%= task.content %></td>
							<td class="align-middle"><%= task.created_at.strftime("%m/%d %H:%M") %></td>
							<td class="text-right">
								<%= link_to laboratory_lab_task_path(@laboratory,task.id,:status => "progress" ), method: :put, class: "btn alert-warning btn-sm", 'data-toggle': :tooltip, 'data-placement': :top, 'title': :"進行中に変更" do %>
								<i class="fas fa-spinner"></i>
								<% end %>
								<%= link_to laboratory_lab_task_path(@laboratory,task,:status => "complete"), method: :put, class: "btn alert-success btn-sm", 'data-toggle': :tooltip, 'data-placement': :top, 'title': :"完了に変更" do %>
								<i class="fas fa-check"></i>
								<% end %>
								<%= link_to laboratory_lab_task_path(@laboratory,task), method: :delete, class: "btn alert-danger btn-sm", 'data-toggle': :tooltip, 'data-placement': :top, 'title': :"削除" do %>
								<i class="fas fa-trash-alt"></i>
								<% end %>
							</td>
						</tr>
					<% end %>
				</tbody>
			</table>
			<%= form_with(model: @lab_task, url: laboratory_lab_tasks_path(@laboratory), local: true, html: { class: "w-100" }) do |f| %>

				<div class="form-group">
					<%= f.text_field :content,  class: "form-control" %>
				</div>

				<div class="form-group text-right">
					<%= f.submit "タスクを追加", class: "btn btn-success btn-sm" %>
				</div>

			<% end %>
		</div>
		<div class="col-12">
			<table class="table">
				<thead class="thead-dark">
					<tr>
						<th class="align-middle" colspan="2">お知らせ</th>
						<th class="text-right" colspan="2"><%= link_to "お知らせを投稿", new_laboratory_lab_information_path(@laboratory), class: "btn btn-info btn-sm" %></th>
					</tr>
				</thead>
				<tbody class="">
					<% @laboratory.lab_informations.order(created_at: "DESC").each do |information| %>
						<tr>
							<td>
								<%= link_to laboratory_lab_information_path(@laboratory,information) ,class: "font-weight-bold text-body link" do %>
									<%= information.subject %>
								<% end %>
							</td>
							<td>
								<div class="">
									<span class="badge badge-info">確認済み：<%= information.lab_information_checks.count %></span>
									<span class="badge badge-success">コメント数：<%= information.lab_information_comments.count %></span>
								</div>
							</td>
							<td>投稿者：<%= information.user.private_name %></td>
							<td class="text-right"><%= information.created_at.strftime("%Y/%m/%d %H:%M") %></td>
						</tr>
					<% end %>
						<tr>
							<td class="text-right" colspan="4"><%= link_to "過去分を確認", laboratory_lab_informations_path(@laboratory) %></td>
						</tr>
				</tbody>
			</table>
		</div>
	</div>
</div>

<!-- Modal -->

<% @events.each do |event| %>
	<div class="modal fade" id="event<%= event.id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="exampleModalCenterTitle">予定の確認</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body pb-0">
	      	<table class="table">
	      		<tbody class="border-bottom">
	      			<tr>
	      				<td>投稿者</td>
	      				<td><%= event.user.private_name %></td>
	      			</tr>
	      			<tr>
	      				<td>開始時刻</td>
	      				<td><%= event.start.strftime("%Y/%m/%d %H:%M") %></td>
	      			</tr>
	      			<tr>
	      				<td>終了時刻</td>
	      				<td><%= event.end.strftime("%Y/%m/%d %H:%M") %></td>
	      			</tr>
	      			<tr>
	      				<td>内容</td>
	      				<td><%= event.title %></td>
	      			</tr>
	      		</tbody>
	      	</table>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">閉じる</button>
	        <%= link_to "削除", laboratory_event_path(@laboratory,event), method: :delete, data: { dismiss: "modal" },  class: "btn btn-danger" %>
	      </div>
	    </div>
	  </div>
	</div>
<% end %>
<div class="modal fade" id="new-event" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle">予定の新規登録</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
      	<%= form_with(model: @event, url: laboratory_events_path(@laboratory), local: true) do |f| %>

		<div class="form-group">
	      	<div class="input-group" data-target-input="nearest">
			    <%= f.text_field :start, id: "start", class: "form-control datepicker", data: { target: '#start' }, placeholder: "開始時刻" %>
			    <div class="input-group-append" data-target="#start" data-toggle="datetimepicker">
			        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
			    </div>
			</div>
		</div>
		<div class="form-group">
			<div class="input-group" data-target-input="nearest">
			    <%= f.text_field :end, id: "end", class: "form-control datepicker", data: { target: '#end'}, placeholder: "終了時刻" %>
			    <div class="input-group-append" data-target="#end" data-toggle="datetimepicker">
			        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
			    </div>
			</div>
		</div>

		<div class="form-group">
			<%= f.text_field :title, class: "form-control", placeholder: "予定を入力" %>
		</div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">閉じる</button>
        <%= f.submit "予定を作成", data: { dismiss: "modal" }, class: "btn btn-success" %>

		<% end %>
      </div>
    </div>
  </div>
</div>
